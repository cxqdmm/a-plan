(window.webpackJsonp=window.webpackJsonp||[]).push([["dashboard-component-terminal-util-LocalEchoController","dashboard-component-terminal-util-HistoryController","dashboard-component-terminal-util-Utils"],{OR8g:function(t,e,r){"use strict";r.r(e),r.d(e,"default",function(){return h});var i=r("1OyB"),s=r("vuIU"),n=r("ld5/"),o=r("YPB7"),h=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(i.a)(this,t),this.term=e,this._handleTermData=this.handleTermData.bind(this),this._handleTermResize=this.handleTermResize.bind(this),this.history=new n.HistoryController(r.historySize||10),this.maxAutocompleteEntries=r.maxAutocompleteEntries||100,this._autocompleteHandlers=[],this._active=!1,this._input="",this._cursor=0,this._activePrompt=null,this._activeCharPrompt=null,this._termSize={cols:this.term.cols,rows:this.term.rows},this.attach()}return Object(s.a)(t,[{key:"detach",value:function(){this.term.off("data",this._handleTermData),this.term.off("resize",this._handleTermResize)}},{key:"attach",value:function(){this.term.on("data",this._handleTermData),this.term.on("resize",this._handleTermResize)}},{key:"addAutocompleteHandler",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];this._autocompleteHandlers.push({fn:t,args:r})}},{key:"removeAutocompleteHandler",value:function(t){var e=this._autocompleteHandlers.findIndex(function(e){return e.fn===t});-1!==e&&this._autocompleteHandlers.splice(e,1)}},{key:"read",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"> ";return new Promise(function(i,s){e.term.write(t),e._activePrompt={prompt:t,promptString:t?t.replace(/(\x1b.*?[m])|(\x1b.*$)/g,"").replace(/\n/,"").replace(/\r/,""):"",continuationPrompt:r,resolve:i,reject:s},e._input="",e._cursor=0,e._active=!0})}},{key:"readChar",value:function(t){var e=this;return new Promise(function(r,i){e.term.write(t),e._activeCharPrompt={prompt:t,resolve:r,reject:i}})}},{key:"abortRead",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"aborted";null==this._activePrompt&&null==this._activeCharPrompt||this.term.write("\r\n"),null!=this._activePrompt&&(this._activePrompt.reject(t),this._activePrompt=null),null!=this._activeCharPrompt&&(this._activeCharPrompt.reject(t),this._activeCharPrompt=null),this._active=!1}},{key:"println",value:function(t){this.print(t+"\n")}},{key:"print",value:function(t){this.term.write(t)}},{key:"printWide",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0==t.length)return this.println("");for(var r=t.reduce(function(t,e){return Math.max(t,e.length)},0)+e,i=Math.floor(this._termSize.cols/r),s=Math.ceil(t.length/i),n=0,o=0;o<s;++o){for(var h="",a=0;a<i;++a)if(n<t.length){var u=t[n++];h+=u+=" ".repeat(r-u.length)}this.println(h)}}},{key:"applyPrompts",value:function(t){var e=(this._activePrompt||{}).prompt||"",r=(this._activePrompt||{}).continuationPrompt||"";return e+t.replace(/\n/g,"\n"+r)}},{key:"applyPromptsString",value:function(t){var e=(this._activePrompt||{}).promptString||"",r=(this._activePrompt||{}).continuationPrompt||"";return e+t.replace(/\n/g,"\n"+r)}},{key:"applyPromptOffset",value:function(t,e){return this.applyPromptsString(t.substr(0,e)).length}},{key:"clearInput",value:function(){var t=this.applyPromptsString(this._input),e=Math.floor(t.length/this._termSize.cols);t.length%this._termSize.cols>0&&(e+=1),console.log("allRows",e);var r=this.applyPromptOffset(this._input,this._cursor),i=Math.floor(r/this._termSize.cols);r%this._termSize.cols&&(i+=1);for(var s=e-i-1,n=0;n<s;++n)this.term.write("\x1b[E");this.term.write("\r\x1b[K");for(n=1;n<e;++n)this.term.write("\x1b[F\x1b[K")}},{key:"setInput",value:function(t){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.clearInput();var e=this.applyPrompts(t);this.term.write(e),this._input=t}},{key:"printAndRestartPrompt",value:function(t){var e=this,r=this._cursor;this.setCursor(this._input.length),this.term.write("\r\n");var i=function(){e._cursor=r,e.setInput(e._input)},s=t();null==s?i():s.then(i)}},{key:"setCursor",value:function(t){t<0&&(t=0),t>this._input.length&&(t=this._input.length);var e=this.applyPrompts(this._input),r=(Object(o.countLines)(e,this._termSize.cols),this.applyPromptOffset(this._input,this._cursor)),i=Object(o.offsetToColRow)(e,r,this._termSize.cols),s=i.col,n=i.row,h=this.applyPromptOffset(this._input,t),a=Object(o.offsetToColRow)(e,h,this._termSize.cols),u=a.col,l=a.row;if(l>n)for(var c=n;c<l;++c)this.term.write("\x1b[B");else for(var p=l;p<n;++p)this.term.write("\x1b[A");if(u>s)for(var m=s;m<u;++m)this.term.write("\x1b[C");else for(var f=u;f<s;++f)this.term.write("\x1b[D");this._cursor=t}},{key:"handleCursorMove",value:function(t){if(t>0){var e=Math.min(t,this._input.length-this._cursor);this.setCursor(this._cursor+e)}else if(t<0){var r=Math.max(t,-this._cursor);this.setCursor(this._cursor+r)}}},{key:"handleCursorErase",value:function(t){var e=this._cursor,r=this._input;if(t){if(e<=0)return;var i=r.substr(0,e-1)+r.substr(e);this.clearInput(),this._cursor-=1,this.setInput(i,!1)}else{var s=r.substr(0,e)+r.substr(e+1);this.setInput(s)}}},{key:"handleCursorInsert",value:function(t){var e=this._cursor,r=this._input,i=r.substr(0,e)+t+r.substr(e);this._cursor+=t.length,this.setInput(i)}},{key:"handleReadComplete",value:function(){this.history&&this.history.push(this._input),this._activePrompt&&(this._activePrompt.resolve(this._input),this._activePrompt=null),this.term.write("\r\n"),this._active=!1}},{key:"handleTermResize",value:function(t){var e=t.rows,r=t.cols;this.clearInput(),this._termSize={cols:r,rows:e},this.setInput(this._input,!1)}},{key:"handleTermData",value:function(t){var e=this;if(this._active){if(null!=this._activeCharPrompt)return this._activeCharPrompt.resolve(t),this._activeCharPrompt=null,void this.term.write("\r\n");if(t.length>3&&27!==t.charCodeAt(0)){var r=t.replace(/[\r\n]+/g,"\r");Array.from(r).forEach(function(t){return e.handleData(t)})}else this.handleData(t)}}},{key:"handleData",value:function(t){var e=this;if(this._active){var r,i=t.charCodeAt(0);if(27===i)switch(t.substr(1)){case"[A":if(this.history){var s=this.history.getPrevious();s&&(this.setInput(s),this.setCursor(s.length))}break;case"[B":if(this.history){var n=this.history.getNext();n||(n=""),this.setInput(n),this.setCursor(n.length)}break;case"[D":this.handleCursorMove(-1);break;case"[C":this.handleCursorMove(1);break;case"[3~":this.handleCursorErase(!1);break;case"[F":this.setCursor(this._input.length);break;case"[H":this.setCursor(0);break;case"b":null!=(r=Object(o.closestLeftBoundary)(this._input,this._cursor))&&this.setCursor(r);break;case"f":null!=(r=Object(o.closestRightBoundary)(this._input,this._cursor))&&this.setCursor(r);break;case"\x7f":null!=(r=Object(o.closestLeftBoundary)(this._input,this._cursor))&&(this.setInput(this._input.substr(0,r)+this._input.substr(this._cursor)),this.setCursor(r))}else if(i<32||127===i)switch(t){case"\r":Object(o.isIncompleteInput)(this._input)?this.handleCursorInsert("\n"):this.handleReadComplete();break;case"\x7f":this.handleCursorErase(!0);break;case"\t":if(this._autocompleteHandlers.length>0){var h=this._input.substr(0,this._cursor),a=Object(o.hasTailingWhitespace)(h),u=Object(o.collectAutocompleteCandidates)(this._autocompleteHandlers,h);if(u.sort(),0===u.length)a||this.handleCursorInsert(" ");else if(1===u.length){var l=Object(o.getLastToken)(h);this.handleCursorInsert(u[0].substr(l.length)+" ")}else u.length<=this.maxAutocompleteEntries?this.printAndRestartPrompt(function(){e.printWide(u)}):this.printAndRestartPrompt(function(){return e.readChar("Display all ".concat(u.length," possibilities? (y or n)")).then(function(t){"y"!=t&&"Y"!=t||e.printWide(u)})})}else this.handleCursorInsert("    ");break;case"\x03":this.setCursor(this._input.length),this.term.write("^C\r\n"+((this._activePrompt||{}).prompt||"")),this._input="",this._cursor=0,this.history&&this.history.rewind();break;case"\v":this.term.clear()}else this.handleCursorInsert(t)}}}]),t}()},YPB7:function(t,e,r){"use strict";r.r(e),r.d(e,"wordBoundaries",function(){return n}),r.d(e,"closestLeftBoundary",function(){return o}),r.d(e,"closestRightBoundary",function(){return h}),r.d(e,"offsetToColRow",function(){return a}),r.d(e,"countLines",function(){return u}),r.d(e,"isIncompleteInput",function(){return l}),r.d(e,"hasTailingWhitespace",function(){return c}),r.d(e,"getLastToken",function(){return p}),r.d(e,"collectAutocompleteCandidates",function(){return m});var i=r("KQm4"),s=r("jjNI");function n(t){for(var e,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],s=/\w+/g;e=s.exec(t);)r?i.push(e.index):i.push(e.index+e[0].length);return i}function o(t,e){var r=n(t,!0).reverse().find(function(t){return t<e});return null==r?0:r}function h(t,e){var r=n(t,!1).find(function(t){return t>e});return null==r?t.length:r}function a(t,e,r){for(var i=0,s=0,n=0;n<e;++n){"\n"===t.charAt(n)?(s=0,i+=1):(s+=1)>r&&(s=0,i+=1)}return{row:i,col:s}}function u(t,e){return a(t,t.length,e).row+1}function l(t){return""!==t.trim()&&((t.match(/'/g)||[]).length%2!==0||((t.match(/"/g)||[]).length%2!==0||(""===t.split(/(\|\||\||&&)/g).pop().trim()||!(!t.endsWith("\\")||t.endsWith("\\\\")))))}function c(t){return null!=t.match(/[^\\][ \t]$/m)}function p(t){return""===t.trim()?"":c(t)?"":Object(s.parse)(t).pop()||""}function m(t,e){var r=Object(s.parse)(e),n=r.length-1,o=r[n]||"";return""===e.trim()?(n=0,o=""):c(e)&&(n+=1,o=""),t.reduce(function(t,e){var s=e.fn,o=e.args;try{return t.concat(s.apply(void 0,[n,r].concat(Object(i.a)(o))))}catch(h){return console.error("Auto-complete error:",h),t}},[]).filter(function(t){return t.startsWith(o)})}},"ld5/":function(t,e,r){"use strict";r.r(e),r.d(e,"HistoryController",function(){return n});var i=r("1OyB"),s=r("vuIU"),n=function(){function t(e){Object(i.a)(this,t),this.size=e,this.entries=[],this.cursor=0}return Object(s.a)(t,[{key:"push",value:function(t){""!==t.trim()&&(t!==this.entries[this.entries.length-1]&&(this.entries.push(t),this.entries.length>this.size&&this.entries.pop(0),this.cursor=this.entries.length))}},{key:"rewind",value:function(){this.cursor=this.entries.length}},{key:"getPrevious",value:function(){var t=Math.max(0,this.cursor-1);return this.cursor=t,this.entries[t]}},{key:"getNext",value:function(){var t=Math.min(this.entries.length,this.cursor+1);return this.cursor=t,this.entries[t]}}]),t}()}}]);
//# sourceMappingURL=dashboard-component-terminal-util-LocalEchoController.c1ec0f32.chunk.js.map